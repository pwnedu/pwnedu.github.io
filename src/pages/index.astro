---
import { Icon } from "astro-icon";
import Card from "@components/Card.astro";
import Title from "../components/Title.svelte";
import Layout from "../layout/Layout.astro";
import ItchSection from "@components/ItchSection.svelte";

const repos = await fetch("https://api.github.com/users/pwnedu/repos").then(
    (res) => res.json()
);

const reposTest = [
    {
        name: "Repo Name",
        description: "Description Test",
        stargazers_count: 6,
        watchers_count: 6,
        html_url: "google.com",
        language: "HTML",
    },
    {
        name: "Repo Name",
        description: "Description Test",
        stargazers_count: 6,
        watchers_count: 6,
        html_url: "google.com",
        language: "HTML",
    },
    {
        name: "Repo Name",
        description: "Description Test",
        stargazers_count: 6,
        watchers_count: 6,
        html_url: "google.com",
        language: "HTML",
    },
    {
        name: "Repo Name",
        description: "Description Test",
        stargazers_count: 6,
        watchers_count: 6,
        html_url: "google.com",
        language: "HTML",
    },
    {
        name: "Repo Name",
        description: "Description Test",
        stargazers_count: 6,
        watchers_count: 6,
        html_url: "google.com",
        language: "HTML",
    },
    {
        name: "Repo Name",
        description: "Description Test",
        stargazers_count: 6,
        watchers_count: 6,
        html_url: "google.com",
        language: "HTML",
    },
];

const socials = [
    {
        name: "Discord",
        icon: "ic:baseline-discord",
    },
    {
        name: "GitHub",
        icon: "mdi:github",
    },
];

const itchio = await fetch(
    `https://itch.io/api/1/${import.meta.env.ITCH_API}/my-games`
).then((res) => res.json());

const updated = itchio["games"].filter(async (game) => {
    const test = await fetch(game.url);
    const text = await test.text();
    return text.includes("You do not have access to this page");
});

console.log(updated);
---

<Layout>
    <div class="flex flex-col gap-8">
        <section class="flex gap-4 group">
            <div class="rounded-md overflow-hidden hidden sm:block relative">
                <img src="/images/avatar.png" class="w-72 h-96" />
                <div
                    class="absolute inset-0 bg-black bg-opacity-70 group-hover:bg-opacity-0 transition-all duration-150 ease-linear"
                >
                </div>
            </div>
            <div class="flex flex-col justify-between gap-12 sm:gap-0">
                <div class="flex flex-col gap-2">
                    <span class="text-4xl">
                        Hey <span>&#128075;</span> I am
                        <Title
                            title="Kiltec"
                            afterTitle="Pwnedu"
                            class="font-mono inline-block hover:bg-white hover:text-black font-bold cursor-default"
                            client:load
                        />
                    </span>
                    <p class="text-xl">
                        <span class="font-semibold font-mono">Developer</span>.
                        I create <a
                            class="font-semibold underline underline-offset-4 hover:text-white/95 transition-colors duration-150 ease-linear font-mono"
                            href="">open-source projects</a
                        > to make development for everyone easier.
                    </p>
                </div>
                <div class="flex flex-col gap-2">
                    <Title
                        class="self-start font-mono text-2xl font-bold cursor-default hover:bg-white hover:text-black"
                        title="Contact me"
                        speed={10}
                        client:load
                    />
                    <div class="flex gap-2">
                        {
                            socials.map((social) => (
                                <button class="transition-colors duration-150 ease-in-out rounded-md cursor-pointer hover:bg-white/80 active:bg-white group">
                                    <Icon
                                        name={social.icon}
                                        class="w-24 h-24 transition-colors duration-150 ease-in-out hover:text-black"
                                    />
                                </button>
                            ))
                        }
                    </div>
                </div>
            </div>
        </section>

        <section class="space-y-4">
            <Title
                class="inline-block px-4 font-mono text-2xl font-bold cursor-default hover:bg-white hover:text-black"
                title="GitHub Projects"
                speed={20}
                client:load
            />
            <ul class="grid grid-flow-row gap-4 md:grid-cols-2">
                {reposTest.map((repo) => <Card repo={repo} />)}
            </ul>
        </section>

        <ItchSection games={updated} client:load />
    </div>
</Layout>
